%% SQL
%% drop view if exists perfparips4opbbstitle CASCADE;
%% create view perfparips4opbbstitle as
%% select perfparips4opbbs.*, titles.title, titles.titleorder from perfparips4opbbs
%% inner join titles
%% on titles.algo like perfparips4opbbs.algo


%% SQL
%% drop view if exists perfparips4oquickbaltitle CASCADE;
%% create view perfparips4oquickbaltitle as
%% select perfparips4oquickbal.*, titles.title, titles.titleorder from perfparips4oquickbal
%% inner join titles
%% on titles.algo like perfparips4oquickbal.algo


%% SQL
%% drop view if exists perfparliteralkeyips4oips2ratitle CASCADE;
%% create view perfparliteralkeyips4oips2ratitle as
%% select perfparliteralkeyips4oips2ra.*, titles.title, titles.titleorder from perfparliteralkeyips4oips2ra
%% inner join titles
%% on titles.algo like perfparliteralkeyips4oips2ra.algo


%% SQL
%% drop view if exists perfparliteralkeyips4oregiontitle CASCADE;
%% create view perfparliteralkeyips4oregiontitle as
%% select perfparliteralkeyips4oregion.*, titles.title, titles.titleorder from perfparliteralkeyips4oregion
%% inner join titles
%% on titles.algo like perfparliteralkeyips4oregion.algo

\begin{figure}[tbp]
  \begin{tikzpicture}
    \begin{groupplot}[
      group style={
        group size=4 by 1,
        x descriptions at=edge bottom,
        y descriptions at=edge left,
        horizontal sep=0.4cm,
      },
      width=0.315\textwidth,
      height=0.2\textheight,
      xmin=1,
      xmax=3,
      ymin=0.0,
      ymax=1.05,
      plotstyleparallelperf,
      xmajorgrids=true,
      ymajorgrids=true,
      subtitle/.style={title=#1},
      ]
      
      \nextgroupplot[
      ylabel={Fraction of inputs},
      ]
      %% MULTIPLOT(algo|ptitle) select title as ptitle, ratio as x, n as y, MULTIPLOT
      %% from perfparips4opbbstitle
      %% order by titleorder, x
      \addplot coordinates { (1,0.975793) (1.25,0.997496) (1.5,0.999165) (1.75,1) (2,1) (2.25,1) (2.5,1) (2.75,1) (3,1) (4.5,1) };
      \addlegendentry{\compiparassssort};
      \addplot coordinates { (1,0.024207) (1.25,0.123539) (1.5,0.338898) (1.75,0.516694) (2,0.656928) (2.25,0.77379) (2.5,0.872287) (2.75,0.912354) (3,0.937396) (4.5,1) };
      \addlegendentry{\compppbbs};
      \addplot coordinates { (4.5,1) };
      \addlegendentry{\comppbalancedsort};
      \addplot coordinates { (4.5,1) };
      \addlegendentry{\radixregion};
      \addplot coordinates { (4.5,1) };
      \addlegendentry{\compiparassrsort};

      \legend{}
      
      \coordinate (c1) at (rel axis cs:0,1);
      
      \nextgroupplot[
      every legend/.append style={at=(ticklabel cs:1.1)},
      legend style={at={($(0,0)+(1cm,1cm)$)},legend columns=6,fill=none,draw=black,anchor=center,align=center},
      legend to name=legendplotsc
      ]
      %% MULTIPLOT(algo|ptitle) select title as ptitle, ratio as x, n as y, MULTIPLOT
      %% from perfparips4oquickbaltitle
      %% order by titleorder, x
      \addplot coordinates { (1,0.998331) (1.25,1) (1.5,1) (1.75,1) (2,1) (2.25,1) (2.5,1) (2.75,1) (3,1) (4.5,1) };
      \addlegendentry{\compiparassssort};
      \addplot coordinates { (4.5,1) };
      \addlegendentry{\compppbbs};
      \addplot coordinates { (1,0.00166945) (1.25,0.00500835) (1.5,0.0175292) (1.75,0.033389) (2,0.0542571) (2.25,0.102671) (2.5,0.199499) (2.75,0.373957) (3,0.530885) (4.5,1) };
      \addlegendentry{\comppbalancedsort};
      \addplot coordinates { (4.5,1) };
      \addlegendentry{\radixregion};
      \addplot coordinates { (4.5,1) };
      \addlegendentry{\compiparassrsort};

      \legend{}
      
      \nextgroupplot[
      ]
      %% MULTIPLOT(algo|ptitle) select title as ptitle, ratio as x, n as y, MULTIPLOT
      %% from perfparliteralkeyips4oregiontitle
      %% order by titleorder, x
      \addplot coordinates { (1,0.741667) (1.25,0.913095) (1.5,0.969048) (1.75,0.986905) (2,0.99881) (2.25,1) (2.5,1) (2.75,1) (3,1) (4.5,1) };
      \addlegendentry{\compiparassssort};
      \addplot coordinates { (4.5,1) };
      \addlegendentry{\compppbbs};
      \addplot coordinates { (4.5,1) };
      \addlegendentry{\comppbalancedsort};
      \addplot coordinates { (1,0.258333) (1.25,0.554762) (1.5,0.710714) (1.75,0.791667) (2,0.829762) (2.25,0.852381) (2.5,0.882143) (2.75,0.913095) (3,0.936905) (4.5,1) };
      \addlegendentry{\radixregion};
      \addplot coordinates { (4.5,1) };
      \addlegendentry{\compiparassrsort};

      \legend{}
      
      \nextgroupplot[
      every legend/.append style={at=(ticklabel cs:1.1)},
      legend style={at={($(0,0)+(1cm,1cm)$)},legend columns=6,fill=none,draw=black,anchor=center,align=center},
      legend to name=legendplotsc
      ]
      %% MULTIPLOT(algo|ptitle) select title as ptitle, ratio as x, n as y, MULTIPLOT
      %% from perfparliteralkeyips4oips2ratitle
      %% order by titleorder, x
      \addplot coordinates { (1,0.62381) (1.25,0.840476) (1.5,0.941667) (1.75,0.983333) (2,0.996429) (2.25,1) (2.5,1) (2.75,1) (3,1) (4.5,1) };
      \addlegendentry{\compiparassssort};
      \addplot coordinates { (4.5,1) };
      \addlegendentry{\compppbbs};
      \addplot coordinates { (4.5,1) };
      \addlegendentry{\comppbalancedsort};
      \addplot coordinates { (4.5,1) };
      \addlegendentry{\radixregion};
      \addplot coordinates { (1,0.37619) (1.25,0.685714) (1.5,0.846429) (1.75,0.869048) (2,0.880952) (2.25,0.890476) (2.5,0.90119) (2.75,0.915476) (3,0.919048) (4.5,1) };
      \addlegendentry{\compiparassrsort};

      \coordinate (c2) at (rel axis cs:1,1);

    \end{groupplot}

    
    \coordinate (c23s) at ($(group c2r1.south)!.5!(group c3r1.south)$);
    \node[yshift=-0.75cm] at (c23s) {{Running time ratio relative to best}};

    \coordinate (c12n) at ($(group c1r1.north)!.5!(group c2r1.north)$);
    \node[yshift=0.3cm] at (c12n) {{All Data Types}};

    \coordinate (c34n) at ($(group c3r1.north)!.5!(group c4r1.north)$);
    \node[yshift=0.3cm] at (c34n) {{Unsigned Integer Key}};

    
    \coordinate (c3) at ($(c1)!.5!(c2)$);
    \node[below] at (c3 |- current bounding box.south)
    {\pgfplotslegendfromname{legendplotsc}};
  \end{tikzpicture}
  \caption{Pairwise performance profiles of \compiparassssort to
    \compppbbs, \comppbalancedsort, \radixregion, and
    \compiparassrsort. The performance plots with \compppbbs and
    \comppbalancedsort use all data types. The performance plots with
    \radixregion and \compiparassrsort use inputs with
    unsigned integer keys (\uint, \ulong, and \pair data types). The
    results were obtained on all machines for all input distributions
    with at least $2^{21}t$ bytes except \distsorted,
    \distreversesorted, and \distones.}\label{fig:perf par}
\end{figure}

